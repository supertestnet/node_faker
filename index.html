<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, user-scalable=no">
        <script src="https://unpkg.com/@cmdcode/tapscript@1.5.3"></script>
        <script src="https://supertestnet.github.io/node_faker/node_faker.js"></script>
        <title>Node Faker</title>
        <style>
            * {
                box-sizing: border-box;
                font-size: 1.15rem;
                font-family: Arial, sans-serif;
            }
            html {
                max-width: 800px;
                padding: 3rem 1rem;
                margin: auto;
                line-height: 1.25;
                padding: 0;
            }
            body {
                margin: 3rem 1rem;
                word-wrap: break-word;
            }
            h1 {
                font-size: 2rem;
            }
            h2 {
                font-size: 1.5rem;
            }
            input, textarea {
                line-height: 1.25;
                width: 100%;
                height: 1.8rem;
                font-size: 1.15rem;
                border: 1px solid grey;
            }
            textarea {
                height: 5rem;
            }
            .hidden {
                display: none !important;
            }
            .supported_commands {
                border: 1px solid black;
                border-radius: 1rem;
                padding: 1rem;
            }
            .response {
                padding: 1rem;
                background-color: #bbb;
                font-family: monospace;
                white-space: pre;
                overflow-x: scroll;
            }
            @media screen and (max-width: 600px) {
            }
        </style>
        <script>
            var $ = document.querySelector.bind( document );
            var $$ = document.querySelectorAll.bind( document );
            var url_params = new URLSearchParams( window.location.search );
            var url_keys = url_params.keys();
            var $_GET = {}
            for ( var key of url_keys ) $_GET[ key ] = url_params.get( key );
            var hash_arr = window.location.href.substring( window.location.href.indexOf( "#" ) ).split( "#" );
            hash_arr.splice( 0, 1 );
            var $_HASH = {}
            hash_arr.forEach( item => {
                var vals = item.split( "=" );
                $_HASH[ vals[ 0 ] ] = vals[ 1 ];
            });
        </script>
    </head>
    <body>
        <h1>Welcome to Node Faker</h1>
        <p>Enter a bitcoin-cli command</p>
        <p><textarea class="command" placeholder="bitcoin-cli getblockchaininfo"></textarea></p>
        <p><button class="submit_command_btn">Submit</button></p>
        <p><button class="list_supported_commands">List supported commands</button></p>
        <div class="supported_commands hidden">
            <p>List of supported commands</p>
            <ul>
                <li>getbestblockhash</li>
                <li>getblock "blockhash" ( verbosity )</li>
                <li>getblockchaininfo</li>
                <li>getdeploymentinfo</li>
                <li>getblockcount</li>
                <li>getblockhash height</li>
                <li>getblockheader "blockhash" ( verbose )</li>
                <li>getrawtransaction "txid" ( verbose )</li>
                <li>gettxout "txid" n ( include_mempool )</li>
                <li>sendrawtransaction "hexstring"</li>
                <li>estimatefee nblocks</li>
                <li>estimatesmartfee conf_target ( "estimate_mode" )</li>
                <li>uptime</li>
                <li>getpeerinfo</li>
                <li>getnetworkinfo</li>
                <li>validateaddress "address"</li>
                <li>getchaintxstats</li>
                <li>scantxoutset "start" ( address in this format: '["addr(bc1qw4c8qlskzhj0zhlj5z6yww5gg27kgzhnf7c5yq)"]' )</li>
                <li>getindexinfo</li>
                <li>getmininginfo</li>
                <li>getnettotals</li>
                <li>getmempoolinfo</li>
                <li>getrawmempool</li>
            </ul>
        </div>
        <p>Response:</p>
        <p class="response">None yet</p>
        <script>
            $( '.list_supported_commands' ).onclick = () => {
                if ( !$( '.supported_commands' ).classList.contains( "hidden" ) ) $( '.supported_commands' ).classList.add( "hidden" );
                else $( '.supported_commands' ).classList.remove( "hidden" );
            }
            $( '.submit_command_btn' ).onclick = async () => {
                var command = $( '.command' ).value;
                node_faker.status = {
                    command,
                    message: "loading...",
                }
                var loop = async () => {
                    $( '.response' ).innerText = node_faker.status.message;
                    await node_faker.waitSomeTime( 1000 );
                    if ( node_faker.status ) loop();
                }
                loop();
                var result = await node_faker.processCommand( command );
                if ( typeof result === "object" ) result = JSON.stringify( result, false, 4 );
                $( '.response' ).innerText = result;
            }
            node_faker.waitWhenParsingTxs = true;
        </script>
    </body>
</html>
